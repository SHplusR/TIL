엔티티 매니저는 엔티티를 저장하고 , 수정하고, 삭제하고, 조회하는 등 엔티티와 관련된 모든일을 처리한다. 이런 엔티티 매니저를 만드는것을 엔티티 매니저 팩토리 (공장) 이라고 말한다.

**이때 주의점은 엔티티 매니저 팩토리는 생성하는데 비용이 많이 드므로, 딱 한번만 생성하고 이를 서로 다른 스레드 간 공유한다.**

**( 여러 스레드가 동시에 사용해도 안전하다!)**

**하지만 엔티티 매니저는 여러 스레드가 동시에 들어오면 동시성 문제가 생기므로, 스레드간 공유는 절대 안 된다!!**

영속성 콘테스트 (persist context)란 엔티티를 영구 저장하는 환경 이라고 할 수 있다.

엔티티의 생명주기는

1\. 비영속

2\. 영속

3\. 준영속

4\. 삭제

로 존재하는데, 해당 상태는 모두 엔티티 매니저를 사용하여 변경 가능하다!

(엔티티 매니저 안에 영속성 콘텍스트라는 공간이 있고, 여기에 해당 엔티티들을 저장한다고 생각하면 쉽다~)

1\. 비영속

엔티티가 생성만 되고 아직 매니저를 통해 아무 기능을 시행하지 않은 상태를 말한다.

```
String id = "id";
Member member = new Member();
member.setId(id);
member.setUsername("지현");
member.setAge(20);
```

 2. 영속

엔티티를 em.persist() 를 통해 영속 컨텍스트에 저장한 상황이다. 

이때부터 해당 엔티티는 영속 컨텍스트가 관리한다.

```
em.persist(member);
```

\* 이때 em은 이미 앞의 코드에서

```
EntityManager em = emf.createEntityManager(); //엔티티 매니저 생성
```

코드를 통해 생성한 엔티티 매니저다.

3\. 준영속

준영속이란 영속 상태였던 엔티티를 더이상 영속 컨텍스트가 관리하지 않을 때를 말한다.

영속 -> 준영속으로 바꾸는 방법은 세개의 방법이 있는데 모두 준영속이 되는 방법이 다르다.

-   em.detach()
-   em.close()
-   em.clear()

해당 방법에 대한것은 1차캐시, 쓰기 지연등을 설명하고 난 후 다시 설명한다.

4\. 삭제

엔티티를 영속석 컨텍스트와 db에서 삭제함을 뜻한다.

```
em.remove(member);
```